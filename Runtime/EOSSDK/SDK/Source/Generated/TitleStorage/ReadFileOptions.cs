// Copyright Epic Games, Inc. All Rights Reserved.
// This file is automatically generated. Changes to this file may be overwritten.

using System;
using System.Runtime.InteropServices;

namespace Epic.OnlineServices.TitleStorage
{
	/// <summary>
	/// Input data for the <see cref="TitleStorageInterface.ReadFile" /> function
	/// </summary>
	public struct ReadFileOptions
	{
		/// <summary>
		/// Product User ID of the local user who is reading the requested file (optional)
		/// </summary>
		public ProductUserId LocalUserId { get; set; }

		/// <summary>
		/// The file name to read; this file must already exist
		/// </summary>
		public Utf8String Filename { get; set; }

		/// <summary>
		/// The maximum amount of data in bytes should be available to read in a single <see cref="OnReadFileDataCallback" /> call
		/// </summary>
		public uint ReadChunkLengthBytes { get; set; }

		/// <summary>
		/// Callback function to handle copying read data
		/// </summary>
		public OnReadFileDataCallback ReadFileDataCallback { get; set; }

		/// <summary>
		/// Optional callback function to be informed of download progress, if the file is not already locally cached. If set, this will be called at least once before completion if the request is successfully started
		/// </summary>
		public OnFileTransferProgressCallback FileTransferProgressCallback { get; set; }
	}

	[StructLayout(LayoutKind.Sequential)]
	internal struct ReadFileOptionsInternal : ISettable<ReadFileOptions>
	{
		private int m_ApiVersion;
		private IntPtr m_LocalUserId;
		private IntPtr m_Filename;
		private uint m_ReadChunkLengthBytes;
		private IntPtr m_ReadFileDataCallback;
		private IntPtr m_FileTransferProgressCallback;

		public void Set(ref ReadFileOptions other)
		{
			Dispose();

			m_ApiVersion = TitleStorageInterface.READFILE_API_LATEST;
			Helper.Set(other.LocalUserId, ref m_LocalUserId);
			Helper.Set(other.Filename, ref m_Filename);
			m_ReadChunkLengthBytes = other.ReadChunkLengthBytes;
			m_ReadFileDataCallback = other.ReadFileDataCallback != null ? Marshal.GetFunctionPointerForDelegate(OnReadFileDataCallbackInternalImplementation.Delegate) : IntPtr.Zero;
			m_FileTransferProgressCallback = other.FileTransferProgressCallback != null ? Marshal.GetFunctionPointerForDelegate(OnFileTransferProgressCallbackInternalImplementation.Delegate) : IntPtr.Zero;
		}

		public void Dispose()
		{
			Helper.Dispose(ref m_LocalUserId);
			Helper.Dispose(ref m_Filename);
		}
	}
}
